<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Planning s√©curis√© ‚Äî Accueil + Mobile</title>
<style>
  :root{
    --bg:#f6f8ff; --text:#121625; --muted:#6b7280;
    --card:#ffffff; --border:#e5e7eb; --shadow:0 10px 30px rgba(15,23,42,.08);
    --c:#1e88ff; --p:#08a86b; --g:#ff8a2a; --r:#8b5cf6;
    --brand:#2b5cff; --accent:#2b5cff; --danger:#ef4444;
    --sidebar:#ffffff; --sidebar-border:#e5e7eb; --sidebar-hover:#eef2ff;
    --chip:#eef2ff; --chip-bd:#c7d2fe;
    --grad: linear-gradient(135deg,#eaf0ff, #fff);
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg:#0b1220; --text:#e5e7eb; --muted:#9aa3b2;
      --card:#0f172a; --border:#1f2a44; --shadow: 0 10px 30px rgba(0,0,0,.35);
      --sidebar:#0f172a; --sidebar-border:#1f2a44; --sidebar-hover:#18233b;
      --chip:#101b33; --chip-bd:#2c3b63;
      --grad: radial-gradient(1200px 600px at 0% 0%, #102041, #0b1220 60%);
    }
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}

  /* ===== Accueil ===== */
  #home{
    min-height:100vh; display:flex; align-items:center; justify-content:center;
    background: var(--grad);
    padding:24px;
  }
  .home-card{
    width:100%; max-width:740px; background:var(--card); border:1px solid var(--border);
    border-radius:18px; box-shadow:var(--shadow); padding:18px;
  }
  .home-header{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
  .home-title{font-weight:900;font-size:20px;color:var(--brand)}
  .home-grid{
    display:grid; gap:12px;
    grid-template-columns: repeat(2, 1fr);
  }
  @media (min-width:720px){ .home-grid{ grid-template-columns: repeat(4, 1fr) } }
  .person-card{
    background:var(--card); border:1px solid var(--border); border-radius:16px; padding:12px;
    display:flex; flex-direction:column; align-items:center; gap:10px;
    cursor:pointer; transition:transform .12s ease, background .12s ease;
  }
  .person-card:hover{ transform:translateY(-1px); background:var(--sidebar-hover) }
  .avatar{
    width:64px; height:64px; border-radius:50%; border:2px solid var(--border);
    background:#dbeafe; display:flex; align-items:center; justify-content:center; font-weight:900;
    overflow:hidden;
  }
  .avatar img{ width:100%; height:100%; object-fit:cover; display:block }
  .pname{ font-weight:900 }
  .pwd-hint{ font-size:12px; color:var(--muted) }

  .home-actions{display:flex;gap:8px;flex-wrap:wrap}
  .btn{background:#fff;border:1px solid #d1d5db;border-radius:12px;padding:10px 12px;font-weight:800;cursor:pointer;box-shadow:var(--shadow)}
  .btn:hover{background:#f9fbff}
  .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  .btn.ghost{background:transparent}

  /* ===== App ===== */
  .app{display:grid;grid-template-columns:270px 1fr;min-height:100vh}
  .side{background:var(--sidebar);border-right:1px solid var(--sidebar-border);padding:16px 12px}
  .logo{font-weight:900;font-size:18px;letter-spacing:.2px;color:var(--brand);margin-bottom:12px}
  .people{display:flex;flex-direction:column;gap:6px}
  .person{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700}
  .person:hover{background:var(--sidebar-hover)}
  .person.active{background:#e6ecff22;outline:2px solid #c9d2ff55}
  .badge{width:10px;height:10px;border-radius:50%}
  .lock{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:var(--muted)}

  header{
    position:sticky; top:0; background:var(--bg); z-index:15;
    display:flex;gap:10px;align-items:center;justify-content:space-between;padding:12px 12px 10px
  }
  h1{margin:0;font-size:20px}
  #monthLabel{cursor:pointer;border-bottom:2px dashed transparent}
  #monthLabel:hover{border-color:#c7d2fe}
  .muted{color:var(--muted)}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  button{background:#fff;border:1px solid #d1d5db;border-radius:12px;padding:10px 12px;font-weight:800;cursor:pointer;box-shadow:var(--shadow)}
  button:hover{background:#f9fbff}
  button.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  button.danger{border-color:#fecaca;background:#fff1f2;color:#b91c1c}
  button[disabled]{opacity:.6;cursor:not-allowed}
  #menuBtn{display:none;border:1px solid #d1d5db;border-radius:10px;font-weight:900;background:#fff;box-shadow:var(--shadow);padding:8px 10px}

  .wrap{max-width:1100px;margin:0 auto 40px;padding:0 12px}
  .legend{display:flex;gap:12px;flex-wrap:wrap;margin:6px 0 12px}
  .tag{display:inline-flex;gap:8px;align-items:center;font-size:13px;color:#94a3b8}
  .sw{width:14px;height:14px;border-radius:4px;display:inline-block}
  .totals{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:8px}
  .box{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px 14px;box-shadow:var(--shadow)}
  .box h3{margin:0 0 4px;font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
  .box div{font-size:18px;font-weight:900}

  .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:10px}
  .dow{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;text-align:center}
  .card{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;padding:10px;min-height:96px;position:relative;box-shadow:var(--shadow);cursor:pointer;transition:transform .08s ease}
  .card:hover{transform:translateY(-1px)}
  .date{position:absolute;top:8px;left:10px;font-weight:900;font-size:13px;color:#6b7280}
  .pill{display:inline-flex;align-items:center;gap:6px;font-size:13px;padding:6px 10px;border-radius:999px;font-weight:900;margin-top:22px;width:max-content;color:#fff;border:none}
  .pill[data-type="C"]{background:var(--c)} .pill[data-type="P"]{background:var(--p)}
  .pill[data-type="G"]{background:var(--g)} .pill[data-type="R"]{background:var(--r)}
  .note{font-size:12px;color:#8b5cf6;margin-top:6px}
  .empty{opacity:.35}
  footer{color:var(--muted);text-align:center;padding:14px}
  .small{font-size:11px}

  /* Chips + modals */
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0}
  .chip{background:var(--chip);border:1px solid var(--chip-bd);border-radius:999px;padding:7px 10px;font-weight:800;cursor:pointer}
  .chip:hover{background:#e0e7ff33}
  .modal-back{position:fixed;inset:0;background:rgba(2,6,23,.45);display:none;align-items:center;justify-content:center;padding:14px;z-index:30}
  .modal{background:#fff;max-width:620px;width:100%;border-radius:16px;padding:14px;border:1px solid #e5e7eb;box-shadow:0 22px 48px rgba(15,23,42,.22)}
  .modal h2,.modal h3{margin:0 0 8px;font-size:16px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  label{font-size:12px;color:#374151;font-weight:700}
  input,select{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:10px;font-size:14px}
  .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px;flex-wrap:wrap}
  .pm-list{display:flex;flex-direction:column;gap:8px;margin:10px 0}
  .pm-row{display:flex;gap:8px}
  .pm-row input{flex:1}

  /* Overlay + tiroir mobile */
  #overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;z-index:25}
  .side.drawer{position:fixed;top:0;left:0;height:100vh;width:86vw;max-width:320px;transform:translateX(-100%);transition:transform .25s ease;z-index:30;box-shadow:0 20px 60px rgba(0,0,0,.25)}
  .side.drawer.open{transform:translateX(0)}
  body.menu-open{overflow:hidden}

  /* Mobile */
  @media (max-width:880px){
    .app{grid-template-columns:1fr}
    .side{position:static}
    .side.drawer{display:block}
    #menuBtn{display:inline-block}
    .wrap{padding:0 10px}
    .calendar{grid-template-columns:repeat(2,1fr);gap:8px}
    .card{min-height:88px;padding:10px}
    .pill{padding:8px 12px;font-size:14px}
    .chips .chip{padding:9px 12px;font-size:14px}
    .legend{margin-top:6px}
    h1{font-size:18px}
  }
  @media (max-width:390px){
    .calendar{gap:6px}
    .card{min-height:84px}
    .pill{font-size:13px}
  }

  /* Toast */
  .toast{position:fixed;right:18px;bottom:18px;background:#111827;color:#fff;padding:10px 14px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.2);display:none;z-index:50}

  /* Impression / PDF */
  @media print{
    #home, .side, header .toolbar, #menuBtn, #overlay, .modal-back, .small, .toast, #peopleModal, #statsModal{display:none}
    .card{break-inside:avoid}
    .card.work .date{font-weight:900}
    .card.work .pill{font-weight:900}
    body{background:white}
  }
</style>
</head>
<body>

<!-- ===== PAGE D‚ÄôACCUEIL ===== -->
<section id="home">
  <div class="home-card">
    <div class="home-header">
      <div class="home-title">üîê Acc√®s au planning</div>
      <div class="home-actions">
        <button class="btn" id="adminBtn">Admin</button>
        <button class="btn ghost" id="aboutBtn" title="Infos">‚ÑπÔ∏è</button>
      </div>
    </div>
    <p class="pwd-hint" style="margin:4px 0 12px">Choisis une personne. On te demandera son mot de passe (ex : Momo = <b>1</b>). Admin = <b>securite</b>.</p>
    <div class="home-grid" id="homeGrid"></div>
  </div>
</section>

<!-- ===== APPLICATION ===== -->
<div id="app" class="app" style="display:none">
  <!-- Sidebar -->
  <aside class="side">
    <div class="logo">üóìÔ∏è Planning</div>
    <div class="people" id="people"></div>
    <div class="lock" id="lockInfo">üîí √âdition verrouill√©e</div>
    <div style="margin-top:14px;color:var(--muted);font-size:12px">Astuce : clique le <b>mois</b> pour changer.</div>
  </aside>

  <!-- Main -->
  <main>
    <header>
      <button id="menuBtn" aria-label="Ouvrir le menu">‚ò∞</button>
      <h1>
        <span id="monthLabel">ao√ªt 2025</span>
        ‚Äî <span class="muted" id="who">Sabri</span>
      </h1>
      <div class="toolbar">
        <button id="btnHome">Accueil</button>
        <button id="btnLogout" class="danger">D√©connexion</button>
        <button id="btnPdf">PDF</button>
        <button id="btnEdit" disabled>Activer l‚Äô√©dition</button>
        <button id="btnPeople" disabled>Ajout & modification</button>
        <button id="btnSaveAll">Enregistrer</button>
        <button id="btnStats">Stats</button>
        <button id="btnBackup">Export JSON</button>
        <button id="btnImport">Import JSON</button>
        <input type="file" id="fileImport" accept="application/json" hidden>
      </div>
    </header>

    <div class="wrap">
      <div class="legend">
        <span class="tag"><span class="sw" style="background:var(--c)"></span> C</span>
        <span class="tag"><span class="sw" style="background:var(--p)"></span> P</span>
        <span class="tag"><span class="sw" style="background:var(--g)"></span> G</span>
        <span class="tag"><span class="sw" style="background:var(--r)"></span> Ronde/Fin sp√©ciale</span>
      </div>

      <div id="totals" class="totals"></div>
      <div id="cal" class="calendar" aria-live="polite"></div>
      <p class="small">Derni√®re mise √† jour : <span id="now"></span></p>
    </div>
    <footer>Jours travaill√©s en <b>gras</b> sur le PDF. Admin : <b>securite</b>.</footer>
  </main>
</div>

<!-- ===== Modals ===== -->
<div class="modal-back" id="mb">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="mTitle">
    <h2 id="mTitle">Modifier</h2>
    <div class="chips">
      <span class="chip" data-preset='{"type":"P","detail":"Promenade 7h/13h30 - 15h/21h30","autoHours":true}'>Promenade 7h/13h30 - 15h/21h30</span>
      <span class="chip" data-preset='{"type":"P","detail":"Promenade 9h/15h - 16h30/21h30","autoHours":true}'>Promenade 9h/15h - 16h30/21h30</span>
      <span class="chip" data-preset='{"type":"C","detail":"Colline 7h/12h - 13h30/21h30","autoHours":true}'>Colline 7h/12h - 13h30/21h30</span>
      <span class="chip" data-preset='{"type":"C","detail":"Colline 9h/13h30 - 15h/21h30","autoHours":true}'>Colline 9h/13h30 - 15h/21h30</span>
      <span class="chip" data-preset='{"type":"C","detail":"Colline 7h30/12h - 13h/19h30","autoHours":true}'>Colline 7h30/12h - 13h/19h30</span>
      <span class="chip" data-preset='{"type":"C","detail":"Colline 7h30/13h - 14h/21h30","autoHours":true}'>Colline 7h30/13h - 14h/21h30</span>
      <span class="chip" data-preset='{"type":"G","detail":"Grande Arche 7h30/12h - 13h30/21h","autoHours":true}'>Grande Arche 7h30/12h -  
     <script>
/* ====== S√©curit√© ====== */
const ADMIN_PASS = "securite";
const PERSON_PASSES = { Momo:"1", Lucas:"2", Sabri:"3", Sofiane:"4", Hamid:"5", Adam:"6", Iddir:"7", Karim:"8" };

/* ====== √âtat ====== */
let authRole=null, authUser=null, editUnlocked=false;
let current="Sabri", currentYear=2025, currentMonth=7, editing=false;
let people=["Momo","Lucas","Sabri","Sofiane","Hamid","Adam","Iddir","Karim"];
const peopleData={}; // plannings (vides par d√©faut)
const monthNames=["janvier","f√©vrier","mars","avril","mai","juin","juillet","ao√ªt","septembre","octobre","novembre","d√©cembre"];

/* ====== Helpers stockage ====== */
const STORAGE_KEY="planning_secure_v1";
function ensureMonth(name,y,m){ if(!peopleData[name]) peopleData[name]={}; if(!peopleData[name][y]) peopleData[name][y]={}; if(!peopleData[name][y][m]) peopleData[name][y][m]={days:{}}; return peopleData[name][y][m]; }
function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify({people,peopleData,current,currentYear,currentMonth})); }
function loadState(){ try{const s=JSON.parse(localStorage.getItem(STORAGE_KEY)||"null"); if(!s) return; people=s.people||people; Object.assign(peopleData,s.peopleData||{}); current=s.current||current; currentYear=s.currentYear||currentYear; currentMonth=s.currentMonth||currentMonth; }catch{} }

/* ====== Accueil ====== */
function renderHome(){
  const grid=document.getElementById("homeGrid");
  grid.innerHTML="";
  ["Momo","Lucas","Sabri","Sofiane","Hamid","Adam","Iddir","Karim"].forEach(name=>{
    const card=document.createElement("div");
    card.className="person-card";
    card.innerHTML=`
      <div class="avatar"><span>${name[0]}</span></div>
      <div class="pname">${name}</div>
      <div class="pwd-hint">‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>`;
    card.onclick=()=>requestAccess(name);
    grid.appendChild(card);
  });
}
function showHome(){
  document.getElementById("home").style.display="flex";
  document.getElementById("app").style.display="none";
}

/* ====== Auth ====== */
function requestAccess(name){
  const pwd=prompt(`Mot de passe pour ${name} (ou "securite" pour admin) :`);
  if(!pwd) return;
  if(pwd===ADMIN_PASS){ authRole="admin"; authUser=null; editUnlocked=true; enterApp(name); }
  else if(PERSON_PASSES[name]===pwd){ authRole="user"; authUser=name; editUnlocked=false; enterApp(name); }
  else alert("Mot de passe incorrect.");
}
document.getElementById("adminBtn")?.addEventListener("click",()=>{
  const pwd=prompt("Mot de passe administrateur :");
  if(pwd===ADMIN_PASS){ authRole="admin"; editUnlocked=true; enterApp("Sabri"); } else alert("Mot de passe incorrect.");
});

/* ====== Entr√©e dans l‚Äôapp ====== */
function enterApp(initialName){
  current=initialName||current;
  document.getElementById("home").style.display="none";
  document.getElementById("app").style.display="grid";
  renderSidebar(); render(); // dessine menu + calendrier
}

/* ====== Sidebar ====== */
function renderSidebar(){
  const peopleEl=document.getElementById("people");
  peopleEl.innerHTML="";
  const visible = (authRole==="admin") ? people : [authUser];
  visible.forEach(name=>{
    const el=document.createElement("div");
    el.className="person"+(name===current?" active":"");
    el.innerHTML=`<span class="badge" style="background:#9bd0ff"></span>${name}`;
    el.onclick=()=>{current=name; renderSidebar(); render();};
    peopleEl.appendChild(el);
  });
  document.getElementById("lockInfo").textContent = editUnlocked ? "‚úÖ Admin (√©dition autoris√©e)" : "üëÅÔ∏è Lecture seule";
}

/* ====== Calendrier (affichage simple) ====== */
function render(){
  document.getElementById("who").textContent=current;
  document.getElementById("monthLabel").textContent=`${monthNames[currentMonth]} ${currentYear}`;
  const cal=document.getElementById("cal"); cal.innerHTML="";
  ['lun','mar','mer','jeu','ven','sam','dim'].forEach(d=>{ const el=document.createElement('div'); el.className='dow'; el.textContent=d; cal.appendChild(el); });
  const first=new Date(currentYear,currentMonth,1), offset=(first.getDay()+6)%7, dim=new Date(currentYear,currentMonth+1,0).getDate();
  for(let i=0;i<offset;i++){ cal.appendChild(divCard(true)); }
  const days=ensureMonth(current,currentYear,currentMonth).days;
  for(let d=1; d<=dim; d++){ cal.appendChild(dayCard(d, days[d])); }
  const filled=offset+dim, rest=(7-(filled%7))%7; for(let i=0;i<rest;i++) cal.appendChild(divCard(true));
  document.getElementById('now').textContent=new Date().toLocaleString('fr-FR');
}
function divCard(empty){ const e=document.createElement('div'); e.className='card'+(empty?' empty':''); return e; }
function dayCard(day,info){
  const card=divCard(false);
  const n=document.createElement('div'); n.className='date'; n.textContent=String(day).padStart(2,'0'); card.appendChild(n);
  if(info){ const pill=document.createElement('div'); pill.className='pill'; pill.dataset.type=info.type||'C'; pill.style.background=({C:'var(--c)',P:'var(--p)',G:'var(--g)',R:'var(--r)'}[info.type]||'var(--c)'); pill.innerHTML=`<span>${info.type||'C'}</span> <small>${String(info.hours||0).replace('.',',')} h</small>`; card.appendChild(pill); if(info.note){ const nn=document.createElement('div'); nn.className='note'; nn.textContent=info.note; card.appendChild(nn);} card.classList.add('work'); }
  // √©dition seulement pour admin
  if(editUnlocked){ card.onclick=()=>{ const detail=prompt("D√©tail :", info?.detail||""); if(detail===null) return; const hoursStr=prompt("Heures (ex 11 ou 8.5) :", info?.hours||""); const hours=Number(hoursStr||0); const type=prompt("Type (C/P/G/R) :", info?.type||"C"); ensureMonth(current,currentYear,currentMonth).days[day]={type:(type||"C").toUpperCase(),hours,detail,note:""}; saveState(); render(); }; }
  return card;
}

/* ====== Changement de mois ====== */
document.getElementById("monthLabel").onclick=()=>{
  const pick=prompt("Mois (1‚Äì12) et ann√©e (ex: 08/2025) :", `${String(currentMonth+1).padStart(2,'0')}/${currentYear}`);
  if(!pick) return;
  const m=pick.match(/^\s*(\d{1,2})\s*\/\s*(\d{4})\s*$/);
  if(!m) return alert("Format invalide. Exemple : 08/2025");
  currentMonth=Math.min(11,Math.max(0,parseInt(m[1],10)-1));
  currentYear=parseInt(m[2],10)||currentYear;
  render();
};

/* ====== Boutons header ====== */
document.getElementById('btnHome').onclick=()=>{ authRole=null; authUser=null; editUnlocked=false; showHome(); };
document.getElementById('btnLogout').onclick=()=>{ authRole=null; authUser=null; editUnlocked=false; showHome(); };
document.getElementById('btnPdf').onclick=()=>window.print();
document.getElementById('btnSaveAll').onclick=()=>saveState();

/* ====== D√©marrage ====== */
loadState();
renderHome();
showHome();
</script>

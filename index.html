<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Planning ‚Äî Multi-personnes</title>
<style>
  :root{
    --bg:#f6f8ff; --text:#121625; --muted:#6b7280;
    --card:#ffffff; --border:#e5e7eb; --shadow:0 10px 30px rgba(15,23,42,.08);
    --c:#1e88ff; --p:#08a86b; --g:#ff8a2a; --r:#8b5cf6;
    --brand:#2b5cff; --accent:#2b5cff;
    --sidebar:#ffffff; --sidebar-border:#e5e7eb; --sidebar-hover:#eef2ff;
    --chip:#eef2ff; --chip-bd:#c7d2fe;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .app{display:grid;grid-template-columns:270px 1fr;min-height:100vh}
  /* Sidebar */
  .side{background:var(--sidebar);border-right:1px solid var(--sidebar-border);padding:16px 12px}
  .logo{font-weight:900;font-size:18px;letter-spacing:.2px;color:var(--brand);margin-bottom:12px}
  .people{display:flex;flex-direction:column;gap:6px}
  .person{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700}
  .person:hover{background:var(--sidebar-hover)}
  .person.active{background:#e6ecff;outline:2px solid #c9d2ff}
  .badge{width:10px;height:10px;border-radius:50%}
  /* Main */
  header{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:18px 18px 6px}
  h1{margin:0;font-size:22px}
  #monthLabel{cursor:pointer;border-bottom:2px dashed transparent}
  #monthLabel:hover{border-color:#c7d2fe}
  .muted{color:var(--muted)}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  button{background:#fff;border:1px solid #d1d5db;border-radius:12px;padding:10px 12px;font-weight:800;cursor:pointer;box-shadow:var(--shadow)}
  button:hover{background:#f9fbff}
  .wrap{max-width:1100px;margin:0 auto 40px;padding:0 18px}
  .legend{display:flex;gap:12px;flex-wrap:wrap;margin:8px 0 16px}
  .tag{display:inline-flex;gap:8px;align-items:center;font-size:13px;color:#374151}
  .sw{width:14px;height:14px;border-radius:4px;display:inline-block}
  .totals{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:8px}
  .box{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px 14px;box-shadow:var(--shadow)}
  .box h3{margin:0 0 4px;font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
  .box div{font-size:18px;font-weight:900}
  .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:10px}
  .dow{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;text-align:center}
  .card{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;padding:10px;min-height:96px;position:relative;box-shadow:var(--shadow);cursor:pointer}
  .date{position:absolute;top:8px;left:10px;font-weight:900;font-size:13px;color:#434a5e}
  .pill{display:inline-flex;align-items:center;gap:6px;font-size:13px;padding:6px 10px;border-radius:999px;font-weight:900;margin-top:22px;width:max-content;color:#fff;border:none}
  .pill[data-type="C"]{background:var(--c)} .pill[data-type="P"]{background:var(--p)}
  .pill[data-type="G"]{background:var(--g)} .pill[data-type="R"]{background:var(--r)}
  .note{font-size:12px;color:#6d28d9;margin-top:6px}
  .empty{opacity:.35}
  footer{color:var(--muted);text-align:center;padding:18px}
  .small{font-size:11px}
  /* Modal √©dition */
  .modal-back{position:fixed;inset:0;background:rgba(2,6,23,.45);display:none;align-items:flex-end;justify-content:center;padding:14px;z-index:20}
  .modal{background:#fff;max-width:520px;width:100%;border-radius:16px;padding:14px;border:1px solid #e5e7eb;box-shadow:0 22px 48px rgba(15,23,42,.22)}
  .modal h2{margin:0 0 8px;font-size:16px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  label{font-size:12px;color:#374151;font-weight:700}
  input,select{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:10px;font-size:14px}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0}
  .chip{background:var(--chip);border:1px solid var(--chip-bd);border-radius:999px;padding:7px 10px;font-weight:800;cursor:pointer}
  .chip:hover{background:#e0e7ff}
  .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px;flex-wrap:wrap}
  .danger{border-color:#fecaca;background:#fff1f2}
  /* S√©lecteur de mois */
  .mp-back{position:fixed;inset:0;background:rgba(2,6,23,.45);display:none;align-items:center;justify-content:center;padding:14px;z-index:30}
  .mp{background:#fff;max-width:560px;width:100%;border-radius:16px;border:1px solid #e5e7eb;box-shadow:0 22px 48px rgba(15,23,42,.22);padding:14px}
  .mp h3{margin:0 0 10px;font-size:16px}
  .mp-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  .mp button{width:100%}
  @media (max-width:880px){ .app{grid-template-columns:1fr} .side{position:sticky;top:0;z-index:10} }
  @media print{ .side, header .toolbar, .modal-back, .mp-back, .small{display:none} .card{break-inside:avoid} body{background:white} }
</style>
</head>
<body>
<div class="app">
  <!-- SIDEBAR -->
  <aside class="side">
    <div class="logo">üóìÔ∏è Planning</div>
    <div class="people" id="people"></div>
    <div style="margin-top:14px;color:var(--muted);font-size:12px">Astuce : clique le <b>mois</b> pour changer.</div>
  </aside>

  <!-- MAIN -->
  <main>
    <header>
      <h1><span id="monthLabel">ao√ªt 2025</span> ‚Äî <span class="muted" id="who">Sabri</span></h1>
      <div class="toolbar">
        <button id="btnPdf">Exporter PDF</button>
        <button id="btnEdit">Activer l‚Äô√©dition</button>
      </div>
    </header>

    <div class="wrap">
      <div class="legend">
        <span class="tag"><span class="sw" style="background:var(--c)"></span> C</span>
        <span class="tag"><span class="sw" style="background:var(--p)"></span> P</span>
        <span class="tag"><span class="sw" style="background:var(--g)"></span> G</span>
        <span class="tag"><span class="sw" style="background:var(--r)"></span> Fin sp√©ciale / Ronde</span>
      </div>

      <div id="totals" class="totals"></div>
      <div id="cal" class="calendar" aria-live="polite"></div>
      <p class="small">Derni√®re mise √† jour : <span id="now"></span></p>
    </div>
    <footer>√âdition rapide : clique un jour ‚Üí presets / semaine / plage ‚Üí Enregistrer.</footer>
  </main>
</div>

<!-- MODAL √âDITION -->
<div class="modal-back" id="mb">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="mTitle">
    <h2 id="mTitle">Modifier</h2>
    <div class="chips">
      <span class="chip" data-preset='{"type":"C","hours":11,"detail":"7h‚Äì12 / 13h30‚Äì21h30"}'>C 11h</span>
      <span class="chip" data-preset='{"type":"C","hours":13,"detail":"7h‚Äì12 / 13h30‚Äì21h30"}'>C 13h</span>
      <span class="chip" data-preset='{"type":"G","hours":8.5,"detail":"7h30‚Äì12 / 13h30‚Äì21h"}'>G 8,5h</span>
      <span class="chip" data-preset='{"type":"P","hours":13,"detail":"7h‚Äì13h30 / 15h‚Äì21h30"}'>P 13h</span>
      <span class="chip" data-preset='{"type":"R","hours":2,"detail":"Ronde","note":"Fin 19h"}'>R 2h</span>
      <span class="chip" id="copyPrev">Copier la veille</span>
    </div>
    <div class="row">
      <div>
        <label>Type</label>
        <select id="fType">
          <option value="C">C</option>
          <option value="P">P</option>
          <option value="G">G</option>
          <option value="R">R (Ronde/Fin sp√©ciale)</option>
        </select>
      </div>
      <div>
        <label>Heures</label>
        <input id="fHours" type="number" step="0.5" min="0" />
      </div>
    </div>
    <div class="row" style="margin-top:8px">
      <div>
        <label>D√©tail</label>
        <input id="fDetail" placeholder="7h‚Äì12 / 13h30‚Äì21h30" />
      </div>
      <div>
        <label>Note</label>
        <input id="fNote" placeholder="Fin 19h" />
      </div>
    </div>
    <div class="actions">
      <button id="btnWeek">Remplir la semaine</button>
      <button id="btnRange">Appliquer sur une plage</button>
      <button id="btnDel" class="danger">Supprimer</button>
      <button id="btnClose">Fermer</button>
      <button id="btnSave" style="background:var(--accent);color:#fff;border-color:var(--accent)">Enregistrer</button>
    </div>
  </div>
</div>

<!-- MODAL S√âLECTEUR DE MOIS -->
<div class="mp-back" id="mpb">
  <div class="mp" role="dialog" aria-modal="true">
    <h3>Choisir un mois ‚Äî <span id="curYear"></span></h3>
    <div class="mp-grid" id="monthGrid"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
      <button id="mpClose">Fermer</button>
    </div>
  </div>
</div>

<script>
/* ===== Etat global ===== */
const monthNames = ["janvier","f√©vrier","mars","avril","mai","juin","juillet","ao√ªt","septembre","octobre","novembre","d√©cembre"];
let currentYear = 2025;
let currentMonth = 7; // 0=janvier
let current = "Sabri";
let editing = false;
let editDay = null;

/* ===== Donn√©es multi-personnes / multi-mois =====
   peopleData[person][year][month] = { days:{ 1:{type,hours,detail,note}, ... } }
*/
const people = ["Momo","Lucas","Sabri","Sofiane","Hamid","Adam","Iddir","Karim"];
const peopleData = {};
people.forEach(n=>peopleData[n]={});

function ensureMonth(name, year, month){
  if(!peopleData[name][year]) peopleData[name][year] = {};
  if(!peopleData[name][year][month]) peopleData[name][year][month] = { days:{} };
  return peopleData[name][year][month];
}

/* ==== SABRI ‚Äî Ao√ªt 2025 (les autres vides) ==== */
ensureMonth("Sabri", 2025, 7).days = {
  1:{type:'C', hours:11, detail:'7h‚Äì12 / 13h30‚Äì21h30', note:'Fin 21h'},
  4:{type:'G', hours:8.5, detail:'7h30‚Äì12 / 13h30‚Äì21h'},
  6:{type:'R', hours:3.5, detail:'Ronde', note:'Fin 21h'},
  7:{type:'G', hours:8.5, detail:'7h30‚Äì12 / 13h30‚Äì21h'},
  8:{type:'G', hours:8.5, detail:'7h30‚Äì12 / 13h30‚Äì21h'},
  11:{type:'C', hours:11, detail:'7h‚Äì12 / 13h30‚Äì21h30', note:'Fin 19h'},
  12:{type:'C', hours:11, detail:'7h‚Äì12 / 13h30‚Äì21h30'},
  14:{type:'C', hours:11, detail:'7h‚Äì12 / 13h30‚Äì21h30', note:'Fin 19h'},
  19:{type:'P', hours:13, detail:'7h‚Äì13h30 / 15h‚Äì21h30'},
  20:{type:'C', hours:13, detail:'7h‚Äì12 / 13h30‚Äì21h30'},
  22:{type:'C', hours:13, detail:'7h‚Äì12 / 13h30‚Äì21h30'},
  26:{type:'C', hours:13, detail:'7h‚Äì12 / 13h30‚Äì21h30'},
  27:{type:'P', hours:13, detail:'7h‚Äì13h30 / 15h‚Äì21h30'},
  29:{type:'C', hours:13, detail:'7h‚Äì12 / 13h30‚Äì21h30'}
};

/* ===== Sidebar ===== */
const peopleEl = document.getElementById('people');
people.forEach((name,i)=>{
  const el=document.createElement('div');
  el.className='person'+(name===current?' active':'');
  el.dataset.name=name;
  const dots=['#9bd0ff','#ffd28a','#8ec5ff','#c4f6c1','#ffb4b4','#d7c7ff','#ffe69b','#a0e9dd'];
  el.innerHTML=`<span class="badge" style="background:${dots[i%dots.length]}"></span>${name}`;
  el.onclick=()=>{current=name;document.querySelectorAll('.person').forEach(p=>p.classList.remove('active'));el.classList.add('active');render();}
  peopleEl.appendChild(el);
});

/* ===== Helpers ===== */
const colorOf = t => ({C:'var(--c)',P:'var(--p)',G:'var(--g)',R:'var(--r)'}[t]||'#999');
function weekNumber(dt){ const t=new Date(Date.UTC(dt.getFullYear(),dt.getMonth(),dt.getDate())); const d=t.getUTCDay()||7; t.setUTCDate(t.getUTCDate()+4-d); const y0=new Date(Date.UTC(t.getUTCFullYear(),0,1)); return Math.ceil((((t-y0)/86400000)+1)/7); }
function mondayOf(dt){ const d=(dt.getDay()+6)%7; const m=new Date(dt); m.setDate(dt.getDate()-d); return m; }

/* ===== Rendu ===== */
function render(){
  document.getElementById('who').textContent = current;
  document.getElementById('monthLabel').textContent = `${monthNames[currentMonth]} ${currentYear}`;

  const store = ensureMonth(current, currentYear, currentMonth);
  const days = store.days;
  const cal=document.getElementById('cal'); cal.innerHTML='';
  // Ent√™tes
  ['lun','mar','mer','jeu','ven','sam','dim'].forEach(d=>{const el=document.createElement('div');el.className='dow';el.textContent=d;cal.appendChild(el);});
  // Cases
  const first=new Date(currentYear,currentMonth,1), offset=(first.getDay()+6)%7, dim=new Date(currentYear,currentMonth+1,0).getDate();
  for(let i=0;i<offset;i++){ const e=document.createElement('div'); e.className='card empty'; cal.appendChild(e); }
  for(let day=1; day<=dim; day++){
    const card=document.createElement('div'); card.className='card'; card.dataset.day=day;
    const dd=document.createElement('div'); dd.className='date'; dd.textContent=String(day).padStart(2,'0'); card.appendChild(dd);
    const info=days[day];
    if(info){
      const pill=document.createElement('div'); pill.className='pill'; pill.dataset.type=info.type;
      pill.style.background=colorOf(info.type);
      pill.innerHTML=`<span>${info.type}</span> <small>${String(info.hours).replace('.',',')} h</small>`;
      pill.title=info.detail||''; card.appendChild(pill);
      if(info.note){const n=document.createElement('div');n.className='note';n.textContent=info.note;card.appendChild(n);}
    } else if (editing){
      const plus=document.createElement('div'); plus.className='pill'; plus.style.background='#9aa5b1'; plus.textContent='+ Ajouter'; plus.style.color='#fff'; plus.style.marginTop='22px'; card.appendChild(plus);
    }
    card.onclick=()=> editing && openEditor(day);
    cal.appendChild(card);
  }
  const filled=offset+dim, rest=(7-(filled%7))%7; for(let i=0;i<rest;i++){const e=document.createElement('div');e.className='card empty';cal.appendChild(e);}

  renderTotals(days);
}

function renderTotals(days){
  const totals=document.getElementById('totals'); totals.innerHTML='';
  let monthSum=0; Object.values(days).forEach(v=>monthSum+=Number(v.hours||0));
  totals.appendChild(box('Total mois', `${monthSum.toFixed(2).replace('.',',')} h`));
  const weeks={}; const dim=new Date(currentYear,currentMonth+1,0).getDate();
  for(let d=1; d<=dim; d++){ if(days[d]){ const w=weekNumber(new Date(currentYear,currentMonth,d)); weeks[w]=(weeks[w]||0)+Number(days[d].hours||0);} }
  Object.keys(weeks).sort((a,b)=>a-b).forEach(w=>totals.appendChild(box(`Sem. ${w}`, `${weeks[w].toFixed(2).replace('.',',')} h`)));
  function box(t,val){const el=document.createElement('div'); el.className='box'; el.innerHTML=`<h3>${t}</h3><div>${val}</div>`; return el;}
}

/* ===== Editeur ===== */
const mb=document.getElementById('mb');
const fType=document.getElementById('fType'), fHours=document.getElementById('fHours'), fDetail=document.getElementById('fDetail'), fNote=document.getElementById('fNote');

function openEditor(day){
  editDay=day;
  const d=ensureMonth(current,currentYear,currentMonth).days[day] || {type:'C',hours:'',detail:'',note:''};
  document.getElementById('mTitle').textContent=`${String(day).padStart(2,'0')}/${String(currentMonth+1).padStart(2,'0')}/${currentYear} ‚Äî ${current}`;
  fType.value=d.type||'C'; fHours.value=(d.hours??''); fDetail.value=d.detail||''; fNote.value=d.note||'';
  mb.style.display='flex';
}
function closeEditor(){ mb.style.display='none'; editDay=null; }
document.getElementById('btnClose').onclick=closeEditor;

document.getElementById('btnSave').onclick=()=>{
  if(editDay==null) return;
  ensureMonth(current,currentYear,currentMonth).days[editDay] = {
    type:fType.value, hours:Number(fHours.value||0), detail:fDetail.value.trim(), note:fNote.value.trim()
  };
  closeEditor(); render();
};
document.getElementById('btnDel').onclick=()=>{
  if(editDay==null) return;
  delete ensureMonth(current,currentYear,currentMonth).days[editDay];
  closeEditor(); render();
};
mb.addEventListener('click',e=>{ if(e.target===mb) closeEditor(); });

// Presets + copier veille
document.querySelectorAll('.chip[data-preset]').forEach(ch=>{
  ch.onclick=()=>{const p=JSON.parse(ch.dataset.preset); fType.value=p.type; fHours.value=p.hours; fDetail.value=p.detail||''; fNote.value=p.note||'';};
});
document.getElementById('copyPrev').onclick=()=>{
  if(editDay==null) return;
  const prev=ensureMonth(current,currentYear,currentMonth).days[editDay-1];
  if(prev){ fType.value=prev.type; fHours.value=prev.hours; fDetail.value=prev.detail||''; fNote.value=prev.note||''; }
};

// Semaine & plage
function mondayOf(dt){ const d=(dt.getDay()+6)%7; const m=new Date(dt); m.setDate(dt.getDate()-d); return m; }
document.getElementById('btnWeek').onclick=()=>{
  if(editDay==null) return;
  const dt=new Date(currentYear,currentMonth,editDay);
  const mon=mondayOf(dt);
  const dim=new Date(currentYear,currentMonth+1,0).getDate();
  const payload={type:fType.value,hours:Number(fHours.value||0),detail:fDetail.value.trim(),note:fNote.value.trim()};
  const store=ensureMonth(current,currentYear,currentMonth).days;
  for(let i=0;i<7;i++){ const d=mon.getDate()+i; if(d>=1&&d<=dim){ store[d]={...payload}; } }
  closeEditor(); render();
};
document.getElementById('btnRange').onclick=()=>{
  const ans=prompt("Appliquer du jour X au jour Y (ex: 5-12) :","");
  if(!ans) return;
  const m=ans.match(/^\s*(\d{1,2})\s*[-‚Äì]\s*(\d{1,2})\s*$/); if(!m) return alert("Format invalide. Exemple : 5-12");
  let a=parseInt(m[1],10), b=parseInt(m[2],10); if(a>b) [a,b]=[b,a];
  const dim=new Date(currentYear,currentMonth+1,0).getDate();
  a=Math.max(1,Math.min(dim,a)); b=Math.max(1,Math.min(dim,b));
  const payload={type:fType.value,hours:Number(fHours.value||0),detail:fDetail.value.trim(),note:fNote.value.trim()};
  const store=ensureMonth(current,currentYear,currentMonth).days;
  for(let d=a; d<=b; d++){ store[d]={...payload}; }
  closeEditor(); render();
};

/* ===== S√©lecteur de mois ===== */
const mpb=document.getElementById('mpb'), monthGrid=document.getElementById('monthGrid'), curYearEl=document.getElementById('curYear');
document.getElementById('monthLabel').onclick=()=>{
  curYearEl.textContent=currentYear;
  monthGrid.innerHTML='';
  monthNames.forEach((name,idx)=>{
    const b=document.createElement('button'); b.textContent=name[0].toUpperCase()+name.slice(1);
    b.onclick=()=>{ currentMonth = idx; mpb.style.display='none'; render(); };
    monthGrid.appendChild(b);
  });
  mpb.style.display='flex';
};
document.getElementById('mpClose').onclick=()=> mpb.style.display='none';
mpb.addEventListener('click',e=>{ if(e.target===mpb) mpb.style.display='none'; });

/* ===== Top ===== */
document.getElementById('btnPdf').onclick=()=>window.print();
document.getElementById('btnEdit').onclick=()=>{
  editing=!editing;
  document.getElementById('btnEdit').textContent=editing?'Quitter l‚Äô√©dition':'Activer l‚Äô√©dition';
  if(!editing) closeEditor(); render();
};

/* ===== Boot ===== */
document.getElementById('now').textContent=new Date().toLocaleString('fr-FR');
render();
</script>
</body>
</html>

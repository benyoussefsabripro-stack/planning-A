<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Planning ‚Äî Multi-personnes</title>
<style>
  :root{
    /* th√®me clair */
    --bg:#f6f8ff; --text:#1f2430; --muted:#6b7280;
    --card:#ffffff; --border:#e5e7eb; --shadow:0 6px 20px rgba(15,23,42,.08);
    --c:#1e88ff; --p:#08a86b; --g:#ff8a2a; --r:#8b5cf6; /* couleurs postes */
    --brand:#2b5cff;
    --sidebar:#ffffff; --sidebar-border:#e5e7eb; --sidebar-hover:#eef2ff;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .app{display:grid; grid-template-columns:270px 1fr; min-height:100vh}
  /* Sidebar */
  .side{background:var(--sidebar);border-right:1px solid var(--sidebar-border);padding:16px 12px}
  .logo{font-weight:900; font-size:18px; letter-spacing:.2px; color:var(--brand); margin-bottom:10px}
  .people{display:flex; flex-direction:column; gap:6px}
  .person{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700}
  .person:hover{background:var(--sidebar-hover)}
  .person.active{background:#e6ecff; outline:2px solid #c9d6ff}
  .badge{width:10px;height:10px;border-radius:50%}
  /* Main */
  header{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:18px 18px 6px}
  h1{margin:0;font-size:22px}
  .muted{color:var(--muted)}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  button{background:#fff;border:1px solid #d1d5db;border-radius:12px;padding:10px 12px;font-weight:800;cursor:pointer;box-shadow:var(--shadow)}
  button:hover{background:#fafbff}
  .wrap{max-width:1100px;margin:0 auto 40px;padding:0 18px}
  .legend{display:flex;gap:12px;flex-wrap:wrap;margin:8px 0 16px}
  .tag{display:inline-flex;gap:8px;align-items:center;font-size:13px;color:#374151}
  .sw{width:14px;height:14px;border-radius:4px;display:inline-block}
  .totals{display:grid;grid-template-columns:repeat(5,auto); gap:10px; margin-bottom:8px}
  .box{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px 14px;box-shadow:var(--shadow)}
  .box h3{margin:0 0 4px;font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
  .box div{font-size:18px;font-weight:900}
  .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:10px}
  .dow{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;text-align:center}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:10px;min-height:96px;position:relative;box-shadow:var(--shadow)}
  .date{position:absolute;top:8px;left:10px;font-weight:900;font-size:13px;color:#434a5e}
  .pill{display:inline-flex;align-items:center;gap:6px;font-size:13px;padding:6px 10px;border-radius:999px;font-weight:900;margin-top:22px;width:max-content;color:#fff;border:none}
  .pill[data-type="C"]{background:var(--c)} .pill[data-type="P"]{background:var(--p)}
  .pill[data-type="G"]{background:var(--g)} .pill[data-type="R"]{background:var(--r)}
  .note{font-size:12px;color:#6d28d9;margin-top:6px}
  .empty{opacity:.35}
  footer{color:var(--muted); text-align:center; padding:18px}
  .small{font-size:11px}
  /* Editor drawer */
  .drawer{position:fixed; right:18px; bottom:18px; max-width:420px; width:calc(100% - 36px); background:var(--card);
          border:1px solid var(--border); border-radius:16px; padding:14px; box-shadow:var(--shadow); display:none}
  .drawer.active{display:block}
  .row{display:grid;grid-template-columns:1fr 1fr; gap:10px}
  label{font-size:12px;color:#374151;font-weight:700}
  input,select,textarea{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:10px;font-size:14px}
  .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
  @media (max-width:880px){ .app{grid-template-columns:1fr} .side{position:sticky; top:0; z-index:10} .totals{grid-template-columns:repeat(2,1fr)} }
  @media print{ .side, header .toolbar, .drawer, .small{display:none} .card{break-inside:avoid} body{background:white} }
</style>
</head>
<body>
<div class="app">
  <!-- SIDEBAR -->
  <aside class="side">
    <div class="logo">üóìÔ∏è Planning</div>
    <div class="people" id="people"></div>
    <div style="margin-top:14px;color:var(--muted);font-size:12px">Astuce: clique un nom pour changer de planning.</div>
  </aside>

  <!-- MAIN -->
  <main>
    <header>
      <h1 id="title">ao√ªt 2025 ‚Äî <span class="muted">Sabri</span></h1>
      <div class="toolbar">
        <button id="btnPdf">Exporter PDF</button>
        <button id="btnEdit">Activer l‚Äô√©dition</button>
      </div>
    </header>

    <div class="wrap">
      <div class="legend">
        <span class="tag"><span class="sw" style="background:var(--c)"></span> C</span>
        <span class="tag"><span class="sw" style="background:var(--p)"></span> P</span>
        <span class="tag"><span class="sw" style="background:var(--g)"></span> G</span>
        <span class="tag"><span class="sw" style="background:var(--r)"></span> Fin sp√©ciale / Ronde</span>
      </div>

      <div class="totals">
        <div class="box"><h3>Total mois</h3><div id="sumMonth">‚Äî h</div></div>
        <div class="box"><h3>Sem. 32</h3><div id="w32">‚Äî h</div></div>
        <div class="box"><h3>Sem. 33</h3><div id="w33">‚Äî h</div></div>
        <div class="box"><h3>Sem. 34</h3><div id="w34">‚Äî h</div></div>
        <div class="box"><h3>Sem. 35</h3><div id="w35">‚Äî h</div></div>
      </div>

      <div id="cal" class="calendar" aria-live="polite"></div>
      <p class="small">Derni√®re mise √† jour : <span id="now"></span></p>
    </div>
    <footer>Fait pour toi. Clique ‚ÄúActiver l‚Äô√©dition‚Äù, puis un jour pour modifier.</footer>
  </main>
</div>

<!-- Drawer √âDITION -->
<div class="drawer" id="drawer">
  <div style="font-weight:900;margin-bottom:6px">Modifier ‚Äî <span id="dLabel"></span></div>
  <div class="row">
    <div>
      <label>Type</label>
      <select id="fType">
        <option value="C">C</option>
        <option value="P">P</option>
        <option value="G">G</option>
        <option value="R">R (Ronde/Fin sp√©ciale)</option>
      </select>
    </div>
    <div>
      <label>Heures (ex: 11 ou 8.5)</label>
      <input id="fHours" type="number" step="0.5" min="0" />
    </div>
  </div>
  <div class="row" style="margin-top:8px">
    <div>
      <label>D√©tail</label>
      <input id="fDetail" placeholder="7h‚Äì12 / 13h30‚Äì21h30" />
    </div>
    <div>
      <label>Note</label>
      <input id="fNote" placeholder="Fin 19h" />
    </div>
  </div>
  <div class="actions">
    <button id="btnDelete" style="background:#fff">Supprimer</button>
    <button id="btnClose" style="background:#fff">Fermer</button>
    <button id="btnSave" style="background:#2b5cff;color:#fff;border-color:#2b5cff">Enregistrer</button>
  </div>
</div>

<script>
const MONTH = 7;  // ao√ªt (0=janvier)
const YEAR  = 2025;

// Donn√©es par personne
const peopleData = {
  "Momo": { days: {} },
  "Lucas": { days: {} },
  "Sabri": { days: {
      1:{type:'C', hours:11, detail:'7h‚Äì12 / 13h30‚Äì21h30'},
      4:{type:'G', hours:8.5, detail:'7h30‚Äì12 / 13h30‚Äì21h'},
      6:{type:'R', hours:3.5, detail:'Ronde', note:'Fin 21h'},
      7:{type:'G', hours:8.5, detail:'7h30‚Äì12 / 13h30‚Äì21h'},
      8:{type:'G', hours:8.5, detail:'7h30‚Äì12 / 13h30‚Äì21h'},
      11:{type:'C', hours:11, detail:'7h‚Äì12 / 13h30‚Äì21h30', note:'Fin 19h'},
      12:{type:'C', hours:11, detail:'7h‚Äì12 / 13h30‚Äì21h30'},
      14:{type:'C', hours:11, detail:'7h‚Äì12 / 13h30‚Äì21h30', note:'Fin 19h'},
      19:{type:'P', hours:13, detail:'7h‚Äì13h30 / 15h‚Äì21h30'},
      20:{type:'C', hours:13, detail:'7h‚Äì12 / 13h30‚Äì21h30'},
      22:{type:'C', hours:13, detail:'7h‚Äì12 / 13h30‚Äì21h30'},
      26:{type:'C', hours:13, detail:'7h‚Äì12 / 13h30‚Äì21h30'},
      27:{type:'P', hours:13, detail:'7h‚Äì13h30 / 15h‚Äì21h30'},
      29:{type:'C', hours:13, detail:'7h‚Äì12 / 13h30‚Äì21h30'}
    } },
  "Sofiane": { days: {} }
};

let current = "Sabri";
let editing = false;
let editingDay = null;

// Sidebar
const peopleEl = document.getElementById('people');
["Momo","Lucas","Sabri","Sofiane"].forEach((name,i)=>{
  const el = document.createElement('div');
  el.className = 'person' + (name===current?' active':'');
  el.dataset.name = name;
  el.innerHTML = `<span class="badge" style="background:${['#ffb4b4','#ffd28a','#9bd0ff','#c4f6c1'][i]}"></span>${name}`;
  el.onclick = ()=>{ current=name; document.querySelectorAll('.person').forEach(p=>p.classList.remove('active')); el.classList.add('active'); render(); };
  peopleEl.appendChild(el);
});

function colorOf(t){ return ({C:'var(--c)',P:'var(--p)',G:'var(--g)',R:'var(--r)'}[t]||'#999'); }

function render(){
  document.getElementById('title').innerHTML = `ao√ªt 2025 ‚Äî <span class="muted">${current}</span>`;
  const data = peopleData[current];
  const cal = document.getElementById('cal'); cal.innerHTML = '';

  // headers
  ['lun','mar','mer','jeu','ven','sam','dim'].forEach(d=>{
    const el = document.createElement('div'); el.className='dow'; el.textContent=d; cal.appendChild(el);
  });

  const first = new Date(YEAR, MONTH, 1);
  const offset = (first.getDay()+6)%7;
  const daysInMonth = new Date(YEAR, MONTH+1, 0).getDate();
  for(let i=0;i<offset;i++){ const e=document.createElement('div'); e.className='card empty'; cal.appendChild(e); }

  for(let day=1; day<=daysInMonth; day++){
    const card=document.createElement('div'); card.className='card';
    const dd=document.createElement('div'); dd.className='date'; dd.textContent=String(day).padStart(2,'0'); card.appendChild(dd);

    const info=data.days[day];
    if(info){
      const pill=document.createElement('button'); pill.type='button'; pill.className='pill'; pill.dataset.type=info.type;
      pill.style.background=colorOf(info.type);
      pill.innerHTML=`<span>${info.type}</span> <small>${String(info.hours).replace('.',',')} h</small>`;
      pill.title=info.detail||''; pill.dataset.day=day;
      pill.addEventListener('click', ()=> openEditor(day));
      card.appendChild(pill);

      if(info.note){ const n=document.createElement('div'); n.className='note'; n.textContent=info.note; card.appendChild(n); }
    } else {
      // si edition ON : clic pour cr√©er
      if(editing){
        const add = document.createElement('button');
        add.className='pill'; add.dataset.type='R'; add.style.background='#94a3b8'; add.textContent='Ajouter';
        add.onclick = ()=> openEditor(day);
        add.style.color='#fff';
        add.style.marginTop='22px';
        card.appendChild(add);
      }
      card.addEventListener('click', ()=> editing && openEditor(day));
    }
    cal.appendChild(card);
  }

  const filled = offset + daysInMonth;
  const rest = (7 - (filled % 7)) % 7;
  for(let i=0;i<rest;i++){ const e=document.createElement('div'); e.className='card empty'; cal.appendChild(e); }

  computeTotals();
}

function weekNumber(dt){
  const t = new Date(Date.UTC(dt.getFullYear(), dt.getMonth(), dt.getDate()));
  const d = t.getUTCDay() || 7; t.setUTCDate(t.getUTCDate()+4-d);
  const y0 = new Date(Date.UTC(t.getUTCFullYear(),0,1));
  return Math.ceil((((t - y0)/86400000)+1)/7);
}

function computeTotals(){
  const data = peopleData[current];
  const weeks={32:0,33:0,34:0,35:0}; let month=0;
  Object.entries(data.days).forEach(([day,v])=>{
    const w=weekNumber(new Date(YEAR, MONTH, Number(day)));
    weeks[w]=(weeks[w]||0)+Number(v.hours); month+=Number(v.hours);
  });
  document.getElementById('sumMonth').textContent = month.toFixed(2).replace('.',',')+' h';
  [32,33,34,35].forEach(k=>{
    const el=document.getElementById('w'+k); if(el) el.textContent=(weeks[k]||0).toFixed(2).replace('.',',')+' h';
  });
}

// Editor Drawer
const drawer = document.getElementById('drawer');
function openEditor(day){
  if(!editing) return;
  editingDay = day;
  const data = peopleData[current].days[day] || {type:'C', hours:0, detail:'', note:''};
  document.getElementById('dLabel').textContent = `${String(day).padStart(2,'0')}/08/2025 ‚Äî ${current}`;
  document.getElementById('fType').value = data.type || 'C';
  document.getElementById('fHours').value = data.hours ?? '';
  document.getElementById('fDetail').value = data.detail || '';
  document.getElementById('fNote').value = data.note || '';
  drawer.classList.add('active');
}
function closeEditor(){ drawer.classList.remove('active'); editingDay = null; }

document.getElementById('btnSave').onclick = ()=>{
  if(editingDay==null) return;
  const days = peopleData[current].days;
  days[editingDay] = {
    type: document.getElementById('fType').value,
    hours: Number(document.getElementById('fHours').value || 0),
    detail: document.getElementById('fDetail').value.trim(),
    note: document.getElementById('fNote').value.trim()
  };
  closeEditor(); render();
};
document.getElementById('btnDelete').onclick = ()=>{
  if(editingDay==null) return;
  delete peopleData[current].days[editingDay];
  closeEditor(); render();
};
document.getElementById('btnClose').onclick = closeEditor;

// Top buttons
document.getElementById('btnPdf').onclick = ()=> window.print();
document.getElementById('btnEdit').onclick = ()=>{
  editing = !editing;
  document.getElementById('btnEdit').textContent = editing ? 'Quitter l‚Äô√©dition' : 'Activer l‚Äô√©dition';
  if(!editing) closeEditor(); render();
};

document.getElementById('now').textContent = new Date().toLocaleString('fr-FR');
render();
</script>
</body>
</html>
